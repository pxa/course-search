<nav class="query">

	<div ng-repeat="category in search.criteria" ng-switch="category.select">
		<h1 ui-if="category.label != undefined">{{category.label}}</h1>
		
		<p ng-repeat="alert in category.alerts | filter:{ show: true }" ng-class="{ error: alert.type == 'error' }">{{alert.message}}</p>
		
		<div ng-switch-when="true">
		
			<select ng-model="category.selected" ng-init="selectOne(category)" ng-change="selectOne(category); checkFacets()" ng-options="f.id as f.label group by f.group for f in selectize(category.facets)"></select>
			
		</div>
		<div ng-switch-default>
		
			<div ng-repeat="facetA in category.facets" ng-init="hasOpen = facetA.open != undefined">
		
				<div ng-switch="facetA.radio == undefined" ui-if="!facetA.exclude">
					<label ng-switch-when="true" ng-class="{ active: facetA.value }">
						<input type="checkbox" ng-model="facetA.value" ng-click="checkFacets()" />
						{{facetA.label}}
					</label>
					<div ng-switch-default>
						<label ng-repeat="radio in facetA.radio" ng-class="{ active: facetA.value == radio.value }">
							<input type="radio" ng-model="facetA.value" value="{{radio.value}}" name="facet-{{facetA.id}}" ng-click="checkFacets()" />
							{{radio.label}}
						</label>
					</div>
				</div>
				
				<div ui-if="!hasOpen || facetA.value == facetA.open" class="child">
					<div ng-repeat="facetB in facetA.facets"
						ng-init="hasValue = facetB.value != undefined;
								hasLabel = facetB.label != undefined && facetB.label.length > 0;
								hasSmallLabel = facetB.small != undefined">
						<label ui-if="hasValue && hasLabel" ng-class="{ active: facetB.value }">
							<input type="checkbox" ng-model="facetB.value" ng-click="checkFacets()" />
							{{facetB.label}}
						</label>
						<h2 ui-if="!hasValue && hasLabel">{{facetB.label}} <small ui-if="hasSmallLabel">{{facetB.small}}</small></h2>
						<hr ui-if="!hasValue && !hasLabel && !$first" />
						<div ng-repeat="facetC in facetB.facets">
							<label ui-if="!facetC.exclude" ng-class="{ active: facetC.value }">
								<input type="checkbox" ng-model="facetC.value" ng-click="checkFacets()" />
								{{facetC.label}}
							</label>
						</div>
					</div>
				</div>
			
			</div>
		
		<!--
		
		
			<label ui-if="category.selectAll" ng-class="{ active: category.selectAll.checked, grayed: category.selectAll.grayed }">
				<input type="checkbox" ng-model="category.selectAll.checked" select-all="category" />
				{{category.selectAll.label}}
			</label>
			<label ng-repeat="facet in category.facets" ng-class="{ active: facet.checked }">
				<input type="checkbox" ng-model="facet.checked" />
				{{facet.label}}
			</label>
			<div ng-repeat="facetGroup in category.groups">
				<hr ui-if="!$first || category.selectAll"/>
				<label ng-repeat="facet in facetGroup.facets" ng-class="{ active: facet.checked }">
					<input type="checkbox" ng-model="facet.checked" />
					{{facet.label}}
				</label>
			</div>
		-->
		</div>
	</div>
	<div class="searchBox">

		<div>
			<input type="text" placeholder="{{search.placeholder}}" ng-model="search.query" ui-keydown="{ 'enter': 'searchCourses($event)' }" />
		</div>
		
		<button ng-click="searchCourses()">Go</button>
		
		<details>
			<summary>Examples</summary>
			<dl ng-repeat="group in search.examples">
				<dt>{{group.label}}</dt>
				<dd ng-repeat="example in group.examples">
					<a href ng-click="applySearchExample(example)">{{example}}</a>
				</dd>
			</dl>
		</details>
		
	</div>
</nav>