<div ng-switch="0" class="search">

	<nav ng-switch-when="0" class="initial-search">
		<div ng-repeat="category in search.facets" ng-switch="category.selected != undefined">
			<h1 ui-if="category.label != undefined">{{category.label}}</h1>
			
			<p ui-if="category.error.show" class="error">{{category.error.message}}</p>
			
			<div ng-switch-when="true">
			
				<select ng-model="category.selected" ng-change="checkFacets()" ng-options="f.id as f.label group by f.group for f in selectize(category.facets)"></select>
				
			</div>
			<div ng-switch-default>
			
				<div ng-repeat="facetA in category.facets" ng-init="hasExpanded = facetA.expanded != undefined">
			
					<div ng-switch="facetA.radio == undefined" ui-if="!facetA.exclude">
						<label ng-switch-when="true" ng-class="{ active: facetA.value }">
							<input type="checkbox" ng-model="facetA.value" ng-click="checkFacets()" />
							{{facetA.label}}
						</label>
						<div ng-switch-default class="radio">
							<label ng-repeat="radio in facetA.radio" ng-class="{ active: facetA.value == radio.value }">
								<input type="radio" ng-model="facetA.value" value="{{radio.value}}" name="facet-{{facetA.id}}" ng-click="checkFacets()" />
								{{radio.label}}
							</label>
						</div>
					</div>
					
					<div ui-if="!hasExpanded || facetA.value == false" class="child">
						<div ng-repeat="facetB in facetA.facets"
							ng-init="hasCheck = facetB.value != undefined;
									hasLabel = facetB.label != undefined && facetB.label.length > 0;
									hasSmallLabel = facetB.small != undefined">
							<label ui-if="hasCheck && hasLabel" ng-class="{ active: facetB.value }">
								<input type="checkbox" ng-model="facetB.value" ng-click="checkFacets()" />
								{{facetB.label}}
							</label>
							<h2 ui-if="!hasCheck && hasLabel">{{facetB.label}} <small ui-if="hasSmallLabel">{{facetB.small}}</small></h2>
							<hr ui-if="!hasCheck && !hasLabel && !$first" />
							<div ng-repeat="facetC in facetB.facets">
								<label ui-if="!facetC.exclude" ng-class="{ active: facetC.value }">
									<input type="checkbox" ng-model="facetC.value" ng-click="checkFacets()" />
									{{facetC.label}}
								</label>
							</div>
						</div>
					</div>
				
				</div>
			
			<!--
			
			
				<label ui-if="category.selectAll" ng-class="{ active: category.selectAll.checked, grayed: category.selectAll.grayed }">
					<input type="checkbox" ng-model="category.selectAll.checked" select-all="category" />
					{{category.selectAll.label}}
				</label>
				<label ng-repeat="facet in category.facets" ng-class="{ active: facet.checked }">
					<input type="checkbox" ng-model="facet.checked" />
					{{facet.label}}
				</label>
				<div ng-repeat="facetGroup in category.groups">
					<hr ui-if="!$first || category.selectAll"/>
					<label ng-repeat="facet in facetGroup.facets" ng-class="{ active: facet.checked }">
						<input type="checkbox" ng-model="facet.checked" />
						{{facet.label}}
					</label>
				</div>
			-->
			</div>
		</div>
		<div class="searchBox">

			<div>
				<input type="text" placeholder="{{search.placeholder}}" ng-model="search.query" />
			</div>
			
			<details>
				<summary>Examples</summary>
				<dl ng-repeat="group in search.examples">
					<dt>{{group.label}}</dt>
					<dd ng-repeat="example in group.examples">
						<a href ng-click="applySearchExample(example)">{{example}}</a>
					</dd>
				</dl>
			</details>
			
			<button ng-click="searchCourses()">Search</button>
			
		</div>
	</nav>
	
	<div ng-switch-default>
	
		<nav class="search-results">
			
			<div>
				<label for="searchInput">Search</label>
				<input id="searchInput" ng-model="query" placeholder="Search" />
			</div>
			
			<div ng-repeat="facetGroup in facetGroups" class="facet">
				<h3 ng-click="openFacetGroupDialog(facetGroup)">{{facetGroup.label}}</h3>
				<label ng-repeat="facet in facetGroup.facets | filter:{ value:true }">
					<input type="checkbox" ng-model="facet.value" />
					{{facet.label}}
					<small>{{facet.count}}</small>
				</label>
			</div>
			
		</nav>
		
		<div ng-switch="course.count">
		
			<div ng-switch-when="0" class="empty">
				<h1>No results</h1>
				<p>Try widening your search or <a href="#/search">start over</a>.</p>
			</div>
	
			<div ng-switch-default class="results">
			
				<p><span ng-show="numberOfPages > 1">Page {{currentPage}} of </span>{{courses.count}}
					<span ng-pluralize count="courses.count" when="{ 'one': 'result', 'other': 'results' }"></span>
				</p>
				
				<ol>
					<li ng-repeat="course in courses.results">
						<div ng-include="'partials/course.item.html'"></div>
					</li>
				</ol>
			
				<pagination boundary-links="true" num-pages="numberOfPages" current-page="currentPage" max-size="maxPageSize"></pagination>
			
			</div>
			
		</div>
		
	</div>

</div>